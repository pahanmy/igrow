<!DOCTYPE html>
<html lang="ms">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Coaching i-GROW</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .sidebar {
            transition: width 0.3s ease;
        }

        .sidebar-link.active {
            background-color: #4f46e5;
            color: white;
            border-left: 4px solid #a78bfa;
        }
        
        .sidebar-link:not(.active):hover {
             background-color: #eef2ff;
        }

        .main-content-bg-dark {
             background-color: #0f172a;
             background-image: radial-gradient(circle at 1px 1px, #1e293b 1px, transparent 0);
             background-size: 20px 20px;
        }

        .tab-link.active {
            border-color: #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }
        
        .tab-link.disabled {
            color: #9ca3af;
            cursor: not-allowed;
            border-color: transparent;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        
        .page-content {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .stat-card {
            background-color: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            border-color: #4f46e5;
            transform: translateY(-5px);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body class="text-gray-800">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="sidebar w-64 bg-white shadow-lg flex-shrink-0 flex flex-col">
            <div class="p-8 bg-white flex items-center justify-center border-b">
                <img src="https://i.imgur.com/3Qqm5jN.png" alt="i-GROW Logo" class="h-24">
            </div>
            <nav class="mt-4 flex-1">
                <a href="#" class="sidebar-link active flex items-center py-3 px-6 text-gray-700 transition duration-200" data-page="dashboard">
                    <i class="fas fa-tachometer-alt fa-fw w-6"></i>
                    <span class="ml-4">Dashboard</span>
                </a>
                <a href="#" class="sidebar-link flex items-center py-3 px-6 text-gray-700 transition duration-200" data-page="senarai">
                    <i class="fas fa-users fa-fw w-6"></i>
                    <span class="ml-4">Senarai Coachee</span>
                </a>
                <a href="#" class="sidebar-link flex items-center py-3 px-6 text-gray-700 transition duration-200" data-page="sesi-bimbingan">
                    <i class="fas fa-chalkboard-teacher fa-fw w-6"></i>
                    <span class="ml-4">Sesi Bimbingan</span>
                </a>
                <a href="#" class="sidebar-link flex items-center py-3 px-6 text-gray-700 transition duration-200" data-page="edit-profil">
                    <i class="fas fa-user-edit fa-fw w-6"></i>
                    <span class="ml-4">Profil Saya</span>
                </a>
            </nav>
            <div class="p-4 border-t border-gray-200">
                 <div class="flex items-center">
                    <img src="https://placehold.co/40x40/667eea/ffffff?text=A" alt="Avatar" class="h-10 w-10 rounded-full">
                    <div class="ml-3">
                        <p class="text-sm font-semibold">Ahmad Kassim</p>
                        <p class="text-xs text-gray-500">Coach</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div id="main-content" class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white shadow-sm p-4 flex justify-between items-center">
                 <h1 id="page-title" class="text-2xl font-bold text-gray-700">Dashboard</h1>
                 <div class="flex items-center space-x-4">
                     <button class="text-gray-500 hover:text-gray-700">
                         <i class="fas fa-bell"></i>
                     </button>
                     <button class="text-gray-500 hover:text-gray-700">
                         <i class="fas fa-cog"></i>
                     </button>
                 </div>
            </header>

            <main id="main-panel" class="flex-1 overflow-y-auto p-8">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-content">
                    <!-- Dashboard content rendered by JS -->
                </div>

                <!-- Senarai Coachee Page -->
                <div id="senarai-page" class="page-content hidden">
                     <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                            <div class="relative w-full md:w-1/3">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                                    <i class="fas fa-search text-gray-400"></i>
                                </span>
                                <input id="searchInput" type="text" placeholder="Cari coachee..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <button class="w-full md:w-auto bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"><i class="fas fa-plus mr-2"></i>Tambah Coachee Baru</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-gray-50 text-xs text-gray-700 uppercase">
                                    <tr>
                                        <th class="p-3">#</th>
                                        <th class="p-3">Nama Pegawai</th>
                                        <th class="p-3">Sekolah</th>
                                        <th class="p-3">Sesi 1</th>
                                        <th class="p-3">Sesi 2</th>
                                        <th class="p-3">Sesi 3</th>
                                        <th class="p-3 text-center">Tindakan</th>
                                    </tr>
                                </thead>
                                <tbody id="full-coachee-list-table">
                                    <!-- Full coachee list rendered by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Edit Profil Page -->
                <div id="edit-profil-page" class="page-content hidden">
                     <div class="bg-white p-8 rounded-xl shadow-md max-w-4xl mx-auto">
                        <form class="space-y-6">
                            <div class="flex items-center space-x-6 pb-6 border-b">
                                <img src="https://placehold.co/96x96/667eea/ffffff?text=A" alt="Profile Picture" class="h-24 w-24 rounded-full object-cover ring-4 ring-indigo-100">
                                <div>
                                    <h3 class="text-xl font-bold">Ahmad Bin Kassim</h3>
                                    <p class="text-gray-500">ahmad.kassim@example.com</p>
                                    <label for="foto" class="mt-2 cursor-pointer inline-block bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50">
                                        <span>Tukar Gambar</span>
                                        <input id="foto" type="file" class="sr-only">
                                    </label>
                                </div>
                            </div>
                        
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nama Penuh</label>
                                    <input type="text" id="name" value="Ahmad Bin Kassim" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="jawatan" class="block text-sm font-medium text-gray-700 mb-1">Jawatan</label>
                                    <select id="jawatan" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                        <option selected>School Improvement Specialist Coaches (SISC+)</option>
                                        <option>Guru Besar</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="namasekolah" class="block text-sm font-medium text-gray-700 mb-1">Stesen Bertugas</label>
                                    <select id="namasekolah" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                        <option selected>PPD Miri</option>
                                        <option>SK Jalan Bintang</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="tahun_kerja" class="block text-sm font-medium text-gray-700 mb-1">Tempoh Perkhidmatan (Tahun)</label>
                                    <input type="number" id="tahun_kerja" value="12" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="opsyen" class="block text-sm font-medium text-gray-700 mb-1">Opsyen</label>
                                    <input type="text" id="opsyen" value="Bahasa Melayu" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>

                            <div class="mt-8 text-right">
                                <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 font-semibold transition">Kemaskini Profil</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Sesi Bimbingan Page -->
                <div id="sesi-bimbingan-page" class="page-content hidden">
                    <!-- Sesi content will be rendered by JS -->
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DATA ---
            let coacheeData = [
                { id: 1, name: 'Siti Nurhaliza', avatar: 'S', school: 'SK Jalan Bintang', position: 'Guru', sessions: [ { status: 'Selesai', date: '2024-03-15'}, { status: 'Selesai', date: '2024-04-01'}, { status: 'Selesai', date: '2024-04-20'} ] },
                { id: 2, name: 'Mohd Fairuz', avatar: 'M', school: 'SK Riam Batu Dua', position: 'Juruteknik Komputer', sessions: [ { status: 'Selesai', date: '2024-05-10'}, { status: 'Belum Selesai', date: '2024-05-25'}, { status: 'Akan Datang', date: ''} ] },
                { id: 3, name: 'Lee Chong Wei', avatar: 'L', school: 'SMK Lutong', position: 'Pembantu Tadbir', sessions: [ { status: 'Belum Mula', date: ''}, { status: 'Akan Datang', date: ''}, { status: 'Akan Datang', date: ''} ] },
                { id: 4, name: 'Aina Abdul', avatar: 'A', school: 'SK Tudan', position: 'Guru Muzik', sessions: [ { status: 'Selesai', date: '2024-06-01'}, { status: 'Belum Selesai', date: '2024-06-15'}, { status: 'Akan Datang', date: ''} ] },
            ];
            
            const pageTitles = {
                'dashboard': 'Dashboard Kawalan i-GROW',
                'senarai': 'Senarai Penuh Coachee',
                'sesi-bimbingan': 'Sesi Bimbingan',
                'edit-profil': 'Edit Profil Saya'
            };

            // --- CHART INSTANCE ---
            let coacheeChart = null;

            // --- DOM ELEMENTS ---
            const mainPanelEl = document.getElementById('main-panel');
            const pageTitleEl = document.getElementById('page-title');
            const fullCoacheeListTableEl = document.getElementById('full-coachee-list-table');
            const searchInputEl = document.getElementById('searchInput');

            // --- STATUS BADGE HELPER ---
            const getStatusBadge = (status) => {
                const statuses = {
                    'Selesai': 'bg-green-100 text-green-800',
                    'Belum Selesai': 'bg-yellow-100 text-yellow-800',
                    'Belum Mula': 'bg-red-100 text-red-800',
                    'Akan Datang': 'bg-gray-100 text-gray-800'
                };
                return `<span class="${statuses[status] || statuses['Akan Datang']} text-xs font-medium px-2.5 py-0.5 rounded-full">${status}</span>`;
            };
            
            // --- RENDER FUNCTIONS ---
            function renderDashboard() {
                const dashboardContainer = document.getElementById('dashboard-page');
                mainPanelEl.classList.add('main-content-bg-dark');
                
                // --- Dashboard Stats Calculations ---
                const totalCoachees = coacheeData.length;
                const completedCoachees = coacheeData.filter(c => c.sessions.every(s => s.status === 'Selesai')).length;
                const inProgressCoachees = coacheeData.filter(c => {
                    const completed = c.sessions.filter(s => s.status === 'Selesai').length;
                    return completed > 0 && completed < c.sessions.length;
                }).length;
                const notStartedCoachees = totalCoachees - completedCoachees - inProgressCoachees;
                const upcomingAppointments = coacheeData.filter(c => c.sessions.some(s => s.status === 'Belum Selesai')).length;

                const today = new Date();
                const dateString = today.toLocaleDateString('ms-MY', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                dashboardContainer.innerHTML = `
                    <div class="text-slate-200 mb-8">
                        <h1 class="text-3xl font-bold">Selamat Kembali, Ahmad!</h1>
                        <p class="text-slate-400 mt-1">Hari ini ${dateString}. Berikut adalah ringkasan aktiviti coaching anda.</p>
                    </div>

                    <!-- Stat Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card rounded-xl p-5 text-white">
                            <div class="flex items-center"><div class="p-3 rounded-full bg-sky-500/20"><i class="fas fa-users fa-lg text-sky-400"></i></div></div>
                            <h3 class="text-3xl font-bold mt-4">${totalCoachees}</h3>
                            <p class="text-slate-400">Jumlah Coachee</p>
                        </div>
                         <div class="stat-card rounded-xl p-5 text-white">
                            <div class="flex items-center"><div class="p-3 rounded-full bg-green-500/20"><i class="fas fa-check-double fa-lg text-green-400"></i></div></div>
                            <h3 class="text-3xl font-bold mt-4">${completedCoachees}</h3>
                            <p class="text-slate-400">Selesai Penuh</p>
                        </div>
                        <div class="stat-card rounded-xl p-5 text-white">
                            <div class="flex items-center"><div class="p-3 rounded-full bg-yellow-500/20"><i class="fas fa-tasks fa-lg text-yellow-400"></i></div></div>
                            <h3 class="text-3xl font-bold mt-4">${inProgressCoachees}</h3>
                            <p class="text-slate-400">Dalam Proses</p>
                        </div>
                        <div class="stat-card rounded-xl p-5 text-white">
                            <div class="flex items-center"><div class="p-3 rounded-full bg-violet-500/20"><i class="fas fa-calendar-alt fa-lg text-violet-400"></i></div></div>
                            <h3 class="text-3xl font-bold mt-4">${upcomingAppointments}</h3>
                            <p class="text-slate-400">Janji Temu Aktif</p>
                        </div>
                    </div>

                    <!-- Main Chart & Tasks -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 stat-card rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Status Keseluruhan Coachee</h3>
                            <div class="h-80"><canvas id="coacheeStatusChart"></canvas></div>
                        </div>
                        <div class="stat-card rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Jadual & Notifikasi</h3>
                            <div id="task-list" class="space-y-4">
                                <!-- Tasks rendered here -->
                            </div>
                        </div>
                    </div>
                `;
                
                // --- Render Chart ---
                const ctx = document.getElementById('coacheeStatusChart').getContext('2d');
                if (coacheeChart) {
                    coacheeChart.destroy();
                }
                coacheeChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Selesai', 'Dalam Proses', 'Belum Mula'],
                        datasets: [{
                            label: 'Jumlah Coachee',
                            data: [completedCoachees, inProgressCoachees, notStartedCoachees],
                            backgroundColor: ['#22c55e80', '#f59e0b80', '#ef444480'],
                            borderColor: ['#22c55e', '#f59e0b', '#ef4444'],
                            borderWidth: 1,
                            borderRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#334155' },
                                ticks: { color: '#94a3b8', stepSize: 1 }
                            },
                            x: {
                                grid: { color: 'transparent' },
                                ticks: { color: '#94a3b8' }
                            }
                        }
                    }
                });

                // --- Render Task List ---
                const taskListEl = document.getElementById('task-list');
                const upcomingTasks = coacheeData
                    .filter(c => c.sessions.some(s => s.status === 'Belum Selesai'))
                    .slice(0, 4); // Limit to 4 tasks

                if (upcomingTasks.length > 0) {
                     taskListEl.innerHTML = upcomingTasks.map(task => `
                        <div class="flex items-center p-3 bg-slate-800/50 rounded-lg">
                             <img src="https://placehold.co/32x32/94a3b8/ffffff?text=${task.avatar}" class="w-8 h-8 rounded-full mr-3">
                             <div>
                                <p class="text-sm font-medium text-slate-200">Sesi Seterusnya: ${task.name}</p>
                                <p class="text-xs text-slate-400">${task.school}</p>
                             </div>
                             <button class="ml-auto text-indigo-400 hover:text-indigo-300 go-to-sesi" data-id="${task.id}"><i class="fas fa-arrow-right"></i></button>
                        </div>
                     `).join('');
                } else {
                    taskListEl.innerHTML = `<div class="text-center py-10"><i class="fas fa-check-circle text-green-500 text-3xl"></i><p class="mt-2 text-slate-400">Tiada janji temu aktif.</p></div>`;
                }

            }

            function renderCoacheeListPage(data) {
                fullCoacheeListTableEl.innerHTML = data.map((coachee, index) => `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3 text-gray-600">${index + 1}</td>
                        <td class="p-3 font-medium flex items-center"><img src="https://placehold.co/32x32/94a3b8/ffffff?text=${coachee.avatar}" class="w-8 h-8 rounded-full mr-3">${coachee.name}</td>
                        <td class="p-3 text-gray-600">${coachee.school}</td>
                        ${coachee.sessions.map(session => `<td class="p-3">${getStatusBadge(session.status)}<br><small class="text-gray-400">${session.date}</small></td>`).join('')}
                        <td class="p-3 text-center"><button class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-semibold hover:bg-indigo-200 go-to-sesi" data-id="${coachee.id}">Urus Sesi</button></td>
                    </tr>`).join('');
            }
            
            function renderSesiPage(coacheeId) {
                const coachee = coacheeData.find(c => c.id == coacheeId);
                if (!coachee) return;
                
                const sesiPageContainer = document.getElementById('sesi-bimbingan-page');
                const totalSessions = coachee.sessions.length;
                const completedSessions = coachee.sessions.filter(s => s.status === 'Selesai').length;
                const progress = totalSessions > 0 ? (completedSessions / totalSessions) * 100 : 0;
                const circumference = 2 * Math.PI * 54;
                const offset = circumference - (progress / 100) * circumference;

                let activeTabIndex = coachee.sessions.findIndex(s => s.status !== 'Selesai');
                if (activeTabIndex === -1) activeTabIndex = 0;

                const tabsHTML = coachee.sessions.map((s, i) => {
                    const isLocked = i > 0 && coachee.sessions[i - 1].status !== 'Selesai';
                    const isCompleted = s.status === 'Selesai';
                    const isActive = i === activeTabIndex && !isLocked;

                    let tabClasses = 'tab-link flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition';
                    let iconHTML = '';

                    if (isLocked) { tabClasses += ' disabled'; iconHTML = '<i class="fas fa-lock ml-2"></i>'; } 
                    else if (isCompleted) { tabClasses += ' text-green-600'; iconHTML = '<i class="fas fa-check-circle ml-2 text-green-500"></i>'; }
                    
                    if (isActive) { tabClasses += ' active'; }

                    return `<a href="#" class="${tabClasses}" data-tab="${i+1}">Sesi ${i+1} ${iconHTML}</a>`;
                }).join('');

                sesiPageContainer.innerHTML = `
                    <div class="bg-gradient-to-br from-slate-800 to-slate-900 text-white rounded-xl shadow-2xl p-6 md:p-8 mb-8">
                         <div class="flex flex-col md:flex-row items-center gap-6 md:gap-8">
                            <div class="flex-shrink-0 text-center">
                                <img src="https://placehold.co/100x100/c7d2fe/3730a3?text=${coachee.avatar}" alt="Avatar" class="w-24 h-24 rounded-full ring-4 ring-slate-700/50">
                                <h2 class="text-2xl font-bold mt-4">${coachee.name}</h2>
                                <p class="text-indigo-300 font-medium">${coachee.position}</p>
                            </div>
                            <div class="w-full border-t md:border-t-0 md:border-l border-slate-700 pt-6 md:pt-0 md:pl-8">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <div class="space-y-4">
                                        <h3 class="text-lg font-semibold text-slate-300 border-b border-slate-700 pb-2">Butiran Lanjut</h3>
                                        <div class="flex items-center text-sm"><i class="fas fa-envelope fa-fw w-5 text-indigo-400"></i><span class="ml-3 text-slate-300">${coachee.name.toLowerCase().replace(/ /g, '.')}@example.com</span></div>
                                        <div class="flex items-center text-sm"><i class="fas fa-building fa-fw w-5 text-indigo-400"></i><span class="ml-3 text-slate-300">${coachee.school}</span></div>
                                        <div class="flex items-center text-sm"><i class="fas fa-info-circle fa-fw w-5 text-indigo-400"></i><span class="ml-3 text-slate-300">Status Aktif</span></div>
                                    </div>
                                    <div class="flex flex-col items-center justify-center bg-slate-800/50 rounded-lg p-4">
                                        <h3 class="text-lg font-semibold text-slate-300 mb-3">Kemajuan Sesi</h3>
                                        <div class="relative w-32 h-32">
                                            <svg class="w-full h-full" viewBox="0 0 120 120"><circle class="text-slate-700" stroke-width="8" stroke="currentColor" fill="transparent" r="54" cx="60" cy="60"/><circle class="text-indigo-500" stroke-width="8" stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" stroke-linecap="round" stroke="currentColor" fill="transparent" r="54" cx="60" cy="60" transform="rotate(-90 60 60)"/></svg>
                                            <span class="absolute text-2xl font-bold inset-0 flex items-center justify-center">${Math.round(progress)}%</span>
                                        </div>
                                        <p class="text-sm mt-3 text-slate-400">${completedSessions} / ${totalSessions} Sesi Selesai</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="border-b border-gray-200"><nav class="-mb-px flex space-x-8" aria-label="Tabs">${tabsHTML}</nav></div>
                        <div class="mt-6">
                            ${coachee.sessions.map((s, i) => `
                            <div id="tab-${i+1}-content" class="tab-content ${i !== activeTabIndex ? 'hidden':''}">
                                <form class="space-y-6" data-coachee-id="${coacheeId}" data-session-index="${i}">
                                     <h3 class="font-bold text-lg text-gray-700">Borang Pelaporan Bimbingan Sesi ${i+1}</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Tarikh</label><input type="date" value="${s.date}" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></div>
                                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Masa Bermula</label><input type="time" value="09:30" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></div>
                                    </div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Isu / Topik (Model GROW)</label><textarea rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Refleksi Kendiri Coach</label><textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea></div>
                                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Status Sesi</label><select name="sessionStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg"><option value="${s.status}" selected>${s.status}</option><option value="Selesai">Selesai</option><option value="Belum Selesai">Belum Selesai</option></select></div>
                                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Janji Temu Seterusnya</label><input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></div>
                                    </div>
                                    <div class="flex justify-end space-x-4 pt-4 border-t"><button type="button" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 font-semibold">Isi Semula</button><button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 font-semibold">Hantar & Kemaskini</button></div>
                                </form>
                            </div>`).join('')}
                        </div>
                    </div>
                `;
                addTabListeners('#sesi-bimbingan-page');
                addFormSubmitListener();
            }

            // --- NAVIGATION & EVENT LISTENERS ---
            function switchPage(pageId, coacheeId = null) {
                // Handle background switching
                if (pageId === 'dashboard') {
                    mainPanelEl.classList.add('main-content-bg-dark');
                    mainPanelEl.classList.remove('bg-gray-100');
                } else {
                    mainPanelEl.classList.remove('main-content-bg-dark');
                    mainPanelEl.classList.add('bg-gray-100');
                }

                document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
                const targetPage = document.getElementById(pageId + '-page');
                targetPage.classList.remove('hidden');

                document.querySelectorAll('.sidebar-link').forEach(l => {
                    l.classList.remove('active');
                    if (l.dataset.page === pageId) l.classList.add('active');
                });
                
                pageTitleEl.textContent = pageTitles[pageId] || 'Sistem Coaching';

                if (pageId === 'dashboard') renderDashboard();
                if (pageId === 'sesi-bimbingan' && coacheeId) renderSesiPage(coacheeId); 
                else if (pageId === 'sesi-bimbingan' && !coacheeId) {
                    const sesiPageContainer = document.getElementById('sesi-bimbingan-page');
                    sesiPageContainer.innerHTML = `<div class="bg-white p-8 rounded-xl shadow-md text-center"><h2 class="text-xl font-bold">Sila Pilih Coachee</h2><p class="text-gray-600 mt-2">Pilih seorang coachee daripada halaman 'Senarai Coachee' untuk melihat sesi bimbingan.</p></div>`;
                }
            }

            function addTabListeners(containerSelector) {
                const container = document.querySelector(containerSelector);
                if (!container) return;
                container.addEventListener('click', function(e) {
                    const link = e.target.closest('.tab-link');
                    if (link) {
                        e.preventDefault();
                        if (link.classList.contains('disabled')) return;

                        const tabId = link.dataset.tab;
                        container.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                        container.querySelector('#tab-' + tabId + '-content').classList.remove('hidden');
                        container.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                    }
                });
            }

            function addFormSubmitListener() {
                const form = document.querySelector('#sesi-bimbingan-page form');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const coacheeId = this.dataset.coacheeId;
                        const sessionIndex = parseInt(this.dataset.sessionIndex, 10);
                        const newStatus = this.querySelector('select[name="sessionStatus"]').value;
                        const coachee = coacheeData.find(c => c.id == coacheeId);
                        if(coachee) {
                            coachee.sessions[sessionIndex].status = newStatus;
                            renderSesiPage(coacheeId);
                        }
                    });
                }
            }

            // --- INITIALIZATION ---
            renderCoacheeListPage(coacheeData); // Render other pages in background
            switchPage('dashboard'); // Start on dashboard

            document.querySelector('.sidebar').addEventListener('click', e => {
                const link = e.target.closest('.sidebar-link');
                if (link) {
                    e.preventDefault();
                    switchPage(link.dataset.page);
                }
            });

            document.body.addEventListener('click', e => {
                 if (e.target.closest('.go-to-sesi')) {
                    e.preventDefault();
                    const coacheeId = e.target.closest('.go-to-sesi').dataset.id;
                    switchPage('sesi-bimbingan', coacheeId);
                }
            });

            searchInputEl.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredData = coacheeData.filter(coachee => 
                    coachee.name.toLowerCase().includes(searchTerm) ||
                    coachee.school.toLowerCase().includes(searchTerm)
                );
                renderCoacheeListPage(filteredData);
            });
        });
    </script>
</body>

</html>

